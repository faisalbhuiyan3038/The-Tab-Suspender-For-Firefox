function u(e){document.documentElement.setAttribute("data-theme",e?"dark":"light")}function g(){const e=document.querySelectorAll(".tab"),t=document.querySelectorAll(".tab-content");e.forEach(n=>{n.addEventListener("click",()=>{e.forEach(i=>i.classList.remove("active")),t.forEach(i=>i.classList.remove("active")),n.classList.add("active");const s=n.getAttribute("data-tab");document.getElementById(`${s}-tab`).classList.add("active")})})}function y(e){try{const t=new URL(e);return{display:`${t.hostname}${t.pathname==="/"?"":t.pathname}`,full:e}}catch{return{display:e,full:e}}}function m(e,t){const n=document.getElementById("whitelist");n.innerHTML="";const s=Array.isArray(e)?e:[],i=Array.isArray(t)?t:[];if(s.length===0&&i.length===0){n.innerHTML='<p class="no-items">No whitelisted items</p>';return}const c=document.createElement("div");if(c.className="whitelist-section",c.innerHTML="<h4>Whitelisted Domains</h4>",s.length>0)s.forEach(a=>{const d=document.createElement("div");d.className="whitelist-item",d.innerHTML=`
        <span title="${a}">${a}</span>
        <button class="remove-btn" data-type="domain" data-value="${a}">\xD7</button>
      `,c.appendChild(d)});else{const a=document.createElement("p");a.className="no-items",a.textContent="No domains whitelisted",c.appendChild(a)}n.appendChild(c);const r=document.createElement("div");if(r.className="whitelist-section",r.innerHTML="<h4>Whitelisted Pages</h4>",i.length>0)i.forEach(a=>{const d=y(a),l=document.createElement("div");l.className="whitelist-item",l.innerHTML=`
        <span title="${d.full}">${d.display}</span>
        <button class="remove-btn" data-type="url" data-value="${a}">\xD7</button>
      `,r.appendChild(l)});else{const a=document.createElement("p");a.className="no-items",a.textContent="No pages whitelisted",r.appendChild(a)}n.appendChild(r)}function o(e="Settings saved!"){const t=document.getElementById("status");t&&(window.statusTimeout&&clearTimeout(window.statusTimeout),t.classList.remove("visible"),t.offsetWidth,t.textContent=e,t.classList.add("visible"),window.statusTimeout=setTimeout(()=>{t.classList.remove("visible")},2e3))}const p=["suspendTime","isEnabled","ignoreAudio","ignoreFormInput","ignoreNotifications","ignorePinned","whitelistedDomains","whitelistedUrls","enableScreenshots","captureQuality","resizeWidth","resizeHeight","resizeQuality"];async function w(){try{const[e,t]=await Promise.all([chrome.storage.sync.get(p),chrome.storage.local.get(["darkMode"])]),n={...e,...t},i=n.suspendTime||40,c=n.isEnabled??!0;document.getElementById("suspendTime").value=i,document.getElementById("enableSwitch").checked=c,document.getElementById("ignoreAudio").checked=n.ignoreAudio??!0,document.getElementById("ignoreFormInput").checked=n.ignoreFormInput??!0,document.getElementById("ignoreNotifications").checked=n.ignoreNotifications??!0,document.getElementById("ignorePinned").checked=n.ignorePinned??!0,document.getElementById("darkModeSwitch").checked=n.darkMode??!1,document.getElementById("enableScreenshots").checked=n.enableScreenshots??!1,document.getElementById("captureQuality").value=n.captureQuality||50,document.getElementById("resizeWidth").value=n.resizeWidth||1280,document.getElementById("resizeHeight").value=n.resizeHeight||720,document.getElementById("resizeQuality").value=n.resizeQuality||.5,u(n.darkMode??!1);const r=n.whitelistedDomains||[],a=n.whitelistedUrls||[];m(r,a),g()}catch(e){console.error("Error loading settings:",e)}}document.addEventListener("DOMContentLoaded",w),document.getElementById("whitelist").addEventListener("click",async e=>{if(e.target.classList.contains("remove-btn")){const t=e.target.dataset.type,n=e.target.dataset.value,s=await chrome.storage.sync.get(["whitelistedDomains","whitelistedUrls"]),i=t==="domain"?"whitelistedDomains":"whitelistedUrls",r=(s[i]||[]).filter(l=>l!==n);await chrome.storage.sync.set({[i]:r});const a=t==="domain"?r:s.whitelistedDomains||[],d=t==="url"?r:s.whitelistedUrls||[];m(a,d),o("Whitelist updated")}}),document.getElementById("enableSwitch").addEventListener("change",e=>{const t=e.target.checked;chrome.storage.sync.set({isEnabled:t}),o()}),document.getElementById("darkModeSwitch").addEventListener("change",e=>{const t=e.target.checked;chrome.storage.local.set({darkMode:t}),u(t),chrome.runtime.sendMessage({action:"updateTheme",isDark:t}),o()}),document.getElementById("saveOptionsButton").addEventListener("click",()=>{try{const e=parseInt(document.getElementById("suspendTime").value,10);if(isNaN(e)||e<1||e>1440){o("Time must be between 1 and 1440");return}const t={suspendTime:e,enableScreenshots:document.getElementById("enableScreenshots").checked,ignoreAudio:document.getElementById("ignoreAudio").checked,ignoreFormInput:document.getElementById("ignoreFormInput").checked,ignoreNotifications:document.getElementById("ignoreNotifications").checked,ignorePinned:document.getElementById("ignorePinned").checked};chrome.storage.sync.set(t),o("Options saved!")}catch(e){console.error("Error saving options:",e),o("Error saving options")}}),document.getElementById("saveScreenshotSettings").addEventListener("click",()=>{try{const e=parseInt(document.getElementById("captureQuality").value,10),t=parseInt(document.getElementById("resizeWidth").value,10),n=parseInt(document.getElementById("resizeHeight").value,10),s=parseFloat(document.getElementById("resizeQuality").value);if(isNaN(e)||e<5||e>100){o("Capture Quality must be 5-100");return}if(isNaN(t)||t<100){o("Resize Width must be at least 100");return}if(isNaN(n)||n<100){o("Resize Height must be at least 100");return}if(isNaN(s)||s<.1||s>1){o("Resize Quality must be 0.1-1.0");return}chrome.storage.sync.set({captureQuality:e,resizeWidth:t,resizeHeight:n,resizeQuality:s}),o("Screenshot settings saved!")}catch(e){console.error("Error saving screenshot settings:",e),o("Error saving settings")}});async function h(){return(await chrome.tabs.query({active:!0,currentWindow:!0}))[0]}document.getElementById("whitelistDomainBtn").addEventListener("click",async()=>{try{const e=await h();if(!e.url.match(/^https?:\/\//))return;const n=new URL(e.url).hostname,i=(await chrome.storage.sync.get(["whitelistedDomains"])).whitelistedDomains||[];if(i.includes(n))o(`Domain ${n} already whitelisted`);else{i.push(n),await chrome.storage.sync.set({whitelistedDomains:i});const c=await chrome.storage.sync.get(["whitelistedUrls"]);m(i,c.whitelistedUrls||[]),o(`Domain ${n} whitelisted!`)}}catch(e){console.error("Error whitelisting domain:",e)}}),document.getElementById("whitelistPageBtn").addEventListener("click",async()=>{try{const e=await h();if(!e.url.match(/^https?:\/\//))return;const t=e.url,s=(await chrome.storage.sync.get(["whitelistedUrls"])).whitelistedUrls||[];if(s.includes(t))o("Current page already whitelisted");else{s.push(t),await chrome.storage.sync.set({whitelistedUrls:s});const i=await chrome.storage.sync.get(["whitelistedDomains"]);m(i.whitelistedDomains||[],s),o("Current page whitelisted!")}}catch(e){console.error("Error whitelisting page:",e)}}),document.getElementById("manageDataBtn").addEventListener("click",()=>{chrome.tabs.create({url:chrome.runtime.getURL("data_management.html")}),window.close()}),document.getElementById("configureShortcutsBtn").addEventListener("click",()=>{chrome.tabs.create({url:"chrome://extensions/shortcuts"}),window.close()});
