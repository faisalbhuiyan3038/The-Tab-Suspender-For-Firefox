function m(e){document.documentElement.setAttribute("data-theme",e?"dark":"light")}function g(){const e=document.querySelectorAll(".tab"),t=document.querySelectorAll(".tab-content");e.forEach(s=>{s.addEventListener("click",()=>{e.forEach(i=>i.classList.remove("active")),t.forEach(i=>i.classList.remove("active")),s.classList.add("active");const n=s.getAttribute("data-tab");document.getElementById(`${n}-tab`).classList.add("active")})})}function w(e){try{const t=new URL(e);return{display:`${t.hostname}${t.pathname==="/"?"":t.pathname}`,full:e}}catch{return{display:e,full:e}}}function u(e,t){const s=document.getElementById("whitelist");s.innerHTML="";const n=Array.isArray(e)?e:[],i=Array.isArray(t)?t:[];if(n.length===0&&i.length===0){s.innerHTML='<p class="no-items">No whitelisted items</p>';return}const c=document.createElement("div");if(c.className="whitelist-section",c.innerHTML="<h4>Whitelisted Domains</h4>",n.length>0)n.forEach(a=>{const d=document.createElement("div");d.className="whitelist-item",d.innerHTML=`
        <span title="${a}">${a}</span>
        <button class="remove-btn" data-type="domain" data-value="${a}">\xD7</button>
      `,c.appendChild(d)});else{const a=document.createElement("p");a.className="no-items",a.textContent="No domains whitelisted",c.appendChild(a)}s.appendChild(c);const r=document.createElement("div");if(r.className="whitelist-section",r.innerHTML="<h4>Whitelisted Pages</h4>",i.length>0)i.forEach(a=>{const d=w(a),l=document.createElement("div");l.className="whitelist-item",l.innerHTML=`
        <span title="${d.full}">${d.display}</span>
        <button class="remove-btn" data-type="url" data-value="${a}">\xD7</button>
      `,r.appendChild(l)});else{const a=document.createElement("p");a.className="no-items",a.textContent="No pages whitelisted",r.appendChild(a)}s.appendChild(r)}function o(e="Settings saved!"){const t=document.getElementById("status");t&&(window.statusTimeout&&clearTimeout(window.statusTimeout),t.classList.remove("visible"),t.offsetWidth,t.textContent=e,t.classList.add("visible"),window.statusTimeout=setTimeout(()=>{t.classList.remove("visible")},2e3))}const y=["suspendTime","isEnabled","ignoreAudio","ignoreFormInput","ignoreNotifications","ignorePinned","whitelistedDomains","whitelistedUrls","enableScreenshots","captureQuality","resizeWidth","resizeHeight","resizeQuality"];async function p(){try{const[e,t]=await Promise.all([browser.storage.sync.get(y),browser.storage.local.get(["darkMode"])]),s={...e,...t},i=s.suspendTime||40,c=s.isEnabled??!0;document.getElementById("suspendTime").value=i,document.getElementById("enableSwitch").checked=c,document.getElementById("ignoreAudio").checked=s.ignoreAudio??!0,document.getElementById("ignoreFormInput").checked=s.ignoreFormInput??!0,document.getElementById("ignoreNotifications").checked=s.ignoreNotifications??!0,document.getElementById("ignorePinned").checked=s.ignorePinned??!0,document.getElementById("darkModeSwitch").checked=s.darkMode??!1,document.getElementById("enableScreenshots").checked=s.enableScreenshots??!1,document.getElementById("captureQuality").value=s.captureQuality||50,document.getElementById("resizeWidth").value=s.resizeWidth||1280,document.getElementById("resizeHeight").value=s.resizeHeight||720,document.getElementById("resizeQuality").value=s.resizeQuality||.5,m(s.darkMode??!1);const r=s.whitelistedDomains||[],a=s.whitelistedUrls||[];u(r,a),g()}catch(e){console.error("Error loading settings:",e)}}document.addEventListener("DOMContentLoaded",p),document.getElementById("whitelist").addEventListener("click",async e=>{if(e.target.classList.contains("remove-btn")){const t=e.target.dataset.type,s=e.target.dataset.value,n=await browser.storage.sync.get(["whitelistedDomains","whitelistedUrls"]),i=t==="domain"?"whitelistedDomains":"whitelistedUrls",r=(n[i]||[]).filter(l=>l!==s);await browser.storage.sync.set({[i]:r});const a=t==="domain"?r:n.whitelistedDomains||[],d=t==="url"?r:n.whitelistedUrls||[];u(a,d),o("Whitelist updated")}}),document.getElementById("enableSwitch").addEventListener("change",e=>{const t=e.target.checked;browser.storage.sync.set({isEnabled:t}),o()}),document.getElementById("darkModeSwitch").addEventListener("change",e=>{const t=e.target.checked;browser.storage.local.set({darkMode:t}),m(t),browser.runtime.sendMessage({action:"updateTheme",isDark:t}),o()}),document.getElementById("saveOptionsButton").addEventListener("click",()=>{try{const e=parseInt(document.getElementById("suspendTime").value,10);if(isNaN(e)||e<1||e>1440){o("Time must be between 1 and 1440");return}const t={suspendTime:e,enableScreenshots:document.getElementById("enableScreenshots").checked,ignoreAudio:document.getElementById("ignoreAudio").checked,ignoreFormInput:document.getElementById("ignoreFormInput").checked,ignoreNotifications:document.getElementById("ignoreNotifications").checked,ignorePinned:document.getElementById("ignorePinned").checked};browser.storage.sync.set(t),o("Options saved!")}catch(e){console.error("Error saving options:",e),o("Error saving options")}}),document.getElementById("saveScreenshotSettings").addEventListener("click",()=>{try{const e=parseInt(document.getElementById("captureQuality").value,10),t=parseInt(document.getElementById("resizeWidth").value,10),s=parseInt(document.getElementById("resizeHeight").value,10),n=parseFloat(document.getElementById("resizeQuality").value);if(isNaN(e)||e<5||e>100){o("Capture Quality must be 5-100");return}if(isNaN(t)||t<100){o("Resize Width must be at least 100");return}if(isNaN(s)||s<100){o("Resize Height must be at least 100");return}if(isNaN(n)||n<.1||n>1){o("Resize Quality must be 0.1-1.0");return}browser.storage.sync.set({captureQuality:e,resizeWidth:t,resizeHeight:s,resizeQuality:n}),o("Screenshot settings saved!")}catch(e){console.error("Error saving screenshot settings:",e),o("Error saving settings")}});async function h(){return(await browser.tabs.query({active:!0,currentWindow:!0}))[0]}document.getElementById("whitelistDomainBtn").addEventListener("click",async()=>{try{const e=await h();if(!e.url.match(/^https?:\/\//))return;const s=new URL(e.url).hostname,i=(await browser.storage.sync.get(["whitelistedDomains"])).whitelistedDomains||[];if(i.includes(s))o(`Domain ${s} already whitelisted`);else{i.push(s),await browser.storage.sync.set({whitelistedDomains:i});const c=await browser.storage.sync.get(["whitelistedUrls"]);u(i,c.whitelistedUrls||[]),o(`Domain ${s} whitelisted!`)}}catch(e){console.error("Error whitelisting domain:",e)}}),document.getElementById("whitelistPageBtn").addEventListener("click",async()=>{try{const e=await h();if(!e.url.match(/^https?:\/\//))return;const t=e.url,n=(await browser.storage.sync.get(["whitelistedUrls"])).whitelistedUrls||[];if(n.includes(t))o("Current page already whitelisted");else{n.push(t),await browser.storage.sync.set({whitelistedUrls:n});const i=await browser.storage.sync.get(["whitelistedDomains"]);u(i.whitelistedDomains||[],n),o("Current page whitelisted!")}}catch(e){console.error("Error whitelisting page:",e)}}),document.getElementById("manageDataBtn").addEventListener("click",()=>{browser.tabs.create({url:browser.runtime.getURL("data_management.html")}),window.close()}),document.getElementById("configureShortcutsBtn").addEventListener("click",()=>{browser.tabs.create({url:"https://support.mozilla.org/en-US/kb/manage-extension-shortcuts-firefox"}),window.close()});
