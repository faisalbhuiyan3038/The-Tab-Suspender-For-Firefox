function I(){let e={};return window.location.search.substr(1).split("&").forEach(function(t){let[i,l]=t.split("=");i&&(e[i]=decodeURIComponent(l))}),e}function b(e){document.documentElement.setAttribute("data-theme",e?"dark":"light")}function f(e){if(e)try{document.body.style.backgroundImage=`url(${e})`,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center center",document.body.classList.add("has-bg")}catch(t){console.error("Error applying thumbnail:",t)}}function k(e,t,i,l){return new Promise((n,d)=>{const s=new Image;s.onload=()=>{const r=document.createElement("canvas");let a=s.width,o=s.height;a>o?a>t&&(o=Math.round(o*(t/a)),a=t):o>i&&(a=Math.round(a*(i/o)),o=i),r.width=a,r.height=o,r.getContext("2d").drawImage(s,0,0,a,o),n(r.toDataURL("image/webp",l))},s.onerror=r=>{console.error("Image resize failed",r),d(r)},s.src=e})}async function _(){const e=I(),t=e.origUrl,i=e.title,l=e.favIconUrl,n=e.tabId,d=e.hasCapture==="true",[s,r]=await Promise.all([browser.storage.local.get(["darkMode"]),browser.storage.sync.get(["resizeWidth","resizeHeight","resizeQuality"])]);b(s.darkMode??!1);const a="icons/icon32.png";if(l){const c=document.getElementById("favicon-link");c&&(c.href=l,c.onerror=()=>{c.href=a})}const o=document.createElement("a");o.href=t,o.textContent=t;const m=document.getElementById("page-url");if(m&&m.appendChild(o),document.title=`\u{1F4A4} ${i||t}`,document.body.addEventListener("click",()=>{t&&browser.runtime.sendMessage({action:"resumeTab",origUrl:t})}),n)try{const u=(await browser.storage.local.get("thumbnail_"+n))["thumbnail_"+n];if(u)console.log("Displaying existing thumbnail"),f(u);else if(d){console.log("Processing new screenshot...");const g=(await browser.storage.local.get("temp_img_"+n))["temp_img_"+n];if(g){const p=r.resizeWidth||1280,w=r.resizeHeight||720,y=r.resizeQuality||.5,h=await k(g,p,w,y);await browser.storage.local.set({["thumbnail_"+n]:h}),f(h),await browser.storage.local.remove("temp_img_"+n)}}}catch(c){console.error("Error during screenshot processing:",c),n&&await browser.storage.local.remove("temp_img_"+n)}}_(),browser.runtime.onMessage.addListener(e=>{e.action==="updateTheme"&&b(e.isDark)});
