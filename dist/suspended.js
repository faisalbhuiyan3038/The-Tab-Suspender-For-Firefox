function getQueryParams(){let e={};return window.location.search.substr(1).split("&").forEach(function(t){let[o,n]=t.split("=");o&&(e[o]=decodeURIComponent(n))}),e}function applyTheme(e){document.documentElement.setAttribute("data-theme",e?"dark":"light")}function displayThumbnail(e){if(e)try{document.body.style.backgroundImage=`url(${e})`,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center center",document.body.classList.add("has-bg")}catch(e){console.error("Error applying thumbnail:",e)}}function resizeImage(e,t,o,n){return new Promise((a,r)=>{const i=new Image;i.onload=()=>{const e=document.createElement("canvas");let r=i.width,c=i.height;r>c?r>t&&(c=Math.round(c*(t/r)),r=t):c>o&&(r=Math.round(r*(o/c)),c=o),e.width=r,e.height=c;e.getContext("2d").drawImage(i,0,0,r,c),a(e.toDataURL("image/webp",n))},i.onerror=e=>{console.error("Image resize failed",e),r(e)},i.src=e})}async function init(){const e=getQueryParams(),t=e.origUrl,o=e.title,n=e.favIconUrl,a=e.tabId,r="true"===e.hasCapture,[i,c]=await Promise.all([chrome.storage.local.get(["darkMode"]),chrome.storage.sync.get(["resizeWidth","resizeHeight","resizeQuality"])]);applyTheme(i.darkMode??!1);if(n){const e=document.getElementById("favicon-link");e&&(e.href=n,e.onerror=()=>{e.href="icons/icon32.png"})}const s=document.createElement("a");s.href=t,s.textContent=t;const l=document.getElementById("page-url");if(l&&l.appendChild(s),document.title=`ðŸ’¤ ${o||t}`,document.body.addEventListener("click",()=>{t&&chrome.runtime.sendMessage({action:"resumeTab",origUrl:t})}),a)try{const e=(await chrome.storage.local.get("thumbnail_"+a))["thumbnail_"+a];if(e)console.log("Displaying existing thumbnail"),displayThumbnail(e);else if(r){console.log("Processing new screenshot...");const e=(await chrome.storage.local.get("temp_img_"+a))["temp_img_"+a];if(e){const t=c.resizeWidth||1280,o=c.resizeHeight||720,n=c.resizeQuality||.5,r=await resizeImage(e,t,o,n);await chrome.storage.local.set({["thumbnail_"+a]:r}),displayThumbnail(r),await chrome.storage.local.remove("temp_img_"+a)}}}catch(e){console.error("Error during screenshot processing:",e),a&&await chrome.storage.local.remove("temp_img_"+a)}}init(),chrome.runtime.onMessage.addListener(e=>{"updateTheme"===e.action&&applyTheme(e.isDark)});