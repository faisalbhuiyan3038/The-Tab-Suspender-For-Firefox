function I(){let e={};return window.location.search.substr(1).split("&").forEach(function(t){let[i,l]=t.split("=");i&&(e[i]=decodeURIComponent(l))}),e}function f(e){document.documentElement.setAttribute("data-theme",e?"dark":"light")}function p(e){if(e)try{document.body.style.backgroundImage=`url(${e})`,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center center",document.body.classList.add("has-bg")}catch(t){console.error("Error applying thumbnail:",t)}}function k(e,t,i,l){return new Promise((n,m)=>{const c=new Image;c.onload=()=>{const a=document.createElement("canvas");let r=c.width,o=c.height;r>o?r>t&&(o=Math.round(o*(t/r)),r=t):o>i&&(r=Math.round(r*(i/o)),o=i),a.width=r,a.height=o,a.getContext("2d").drawImage(c,0,0,r,o),n(a.toDataURL("image/webp",l))},c.onerror=a=>{console.error("Image resize failed",a),m(a)},c.src=e})}async function _(){const e=I(),t=e.origUrl,i=e.title,l=e.favIconUrl,n=e.tabId,m=e.hasCapture==="true",[c,a]=await Promise.all([chrome.storage.local.get(["darkMode"]),chrome.storage.sync.get(["resizeWidth","resizeHeight","resizeQuality"])]);f(c.darkMode??!1);const r="icons/icon32.png";if(l){const s=document.getElementById("favicon-link");s&&(s.href=l,s.onerror=()=>{s.href=r})}const o=document.createElement("a");o.href=t,o.textContent=t;const d=document.getElementById("page-url");if(d&&d.appendChild(o),document.title=`\u{1F4A4} ${i||t}`,document.body.addEventListener("click",()=>{t&&chrome.runtime.sendMessage({action:"resumeTab",origUrl:t})}),n)try{const u=(await chrome.storage.local.get("thumbnail_"+n))["thumbnail_"+n];if(u)console.log("Displaying existing thumbnail"),p(u);else if(m){console.log("Processing new screenshot...");const g=(await chrome.storage.local.get("temp_img_"+n))["temp_img_"+n];if(g){const b=a.resizeWidth||1280,y=a.resizeHeight||720,w=a.resizeQuality||.5,h=await k(g,b,y,w);await chrome.storage.local.set({["thumbnail_"+n]:h}),p(h),await chrome.storage.local.remove("temp_img_"+n)}}}catch(s){console.error("Error during screenshot processing:",s),n&&await chrome.storage.local.remove("temp_img_"+n)}}_(),chrome.runtime.onMessage.addListener(e=>{e.action==="updateTheme"&&f(e.isDark)});
