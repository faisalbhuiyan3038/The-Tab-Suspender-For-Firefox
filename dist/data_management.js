function f(o){document.documentElement.setAttribute("data-theme",o?"dark":"light")}function i(o,n=!1){const r=document.getElementById("data-status");r&&(window.dataStatusTimeout&&clearTimeout(window.dataStatusTimeout),r.style.color=n?"#f44336":"#34C759",r.classList.remove("visible"),r.offsetWidth,r.textContent=o,r.classList.add("visible"),window.dataStatusTimeout=setTimeout(()=>{r.classList.remove("visible")},4e3))}const u=["suspendTime","isEnabled","ignoreAudio","ignoreFormInput","ignoreNotifications","whitelistedDomains","whitelistedUrls"];document.addEventListener("DOMContentLoaded",()=>{chrome.storage.local.get(["darkMode"]).then(o=>{f(o.darkMode??!1)})}),document.getElementById("exportSettingsBtn").addEventListener("click",async()=>{try{const o=await chrome.storage.sync.get(u),n=JSON.stringify(o,null,2),r=new Blob([n],{type:"application/json"}),d=URL.createObjectURL(r),e=document.createElement("a");e.href=d,e.download="tab-suspender-settings.json",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(d),i("Settings exported!")}catch(o){console.error("Error exporting settings:",o),i("Export failed",!0)}}),document.getElementById("importSettingsInput").addEventListener("change",o=>{const n=o.target.files[0];if(!n)return;const r=new FileReader;r.onload=async d=>{let e;try{e=JSON.parse(d.target.result)}catch(s){console.error("Error parsing JSON:",s),i("Import failed: Invalid JSON file",!0),o.target.value=null;return}try{const s=await chrome.storage.sync.get(u),a={},m=["isEnabled","ignoreAudio","ignoreFormInput","ignoreNotifications"];for(const t of m)e.hasOwnProperty(t)&&typeof e[t]=="boolean"&&(a[t]=e[t]);if(e.hasOwnProperty("suspendTime")){const t=parseInt(e.suspendTime,10);!isNaN(t)&&t>=1&&t<=1440&&(a.suspendTime=t)}const g=["whitelistedDomains","whitelistedUrls"];for(const t of g)if(e.hasOwnProperty(t)&&Array.isArray(e[t])){const c=new Set(s[t]||[]);for(const l of e[t])typeof l=="string"&&l.length>0&&c.add(l);a[t]=Array.from(c)}if(Object.keys(a).length===0)throw new Error("File contains no valid or recognized settings.");await chrome.storage.sync.set(a),i("Settings imported successfully!")}catch(s){console.error("Error importing settings:",s),i(`Import failed: ${s.message}`,!0)}finally{o.target.value=null}},r.onerror=()=>{console.error("File reading error"),i("Import failed: Could not read file",!0)},r.readAsText(n)});
