function applyTheme(t){document.documentElement.setAttribute("data-theme",t?"dark":"light")}function showDataStatus(t,e=!1){const o=document.getElementById("data-status");o&&(window.dataStatusTimeout&&clearTimeout(window.dataStatusTimeout),o.style.color=e?"#f44336":"#34C759",o.classList.remove("visible"),o.offsetWidth,o.textContent=t,o.classList.add("visible"),window.dataStatusTimeout=setTimeout(()=>{o.classList.remove("visible")},4e3))}const SYNC_SETTINGS_KEYS=["suspendTime","isEnabled","ignoreAudio","ignoreFormInput","ignoreNotifications","whitelistedDomains","whitelistedUrls"];document.addEventListener("DOMContentLoaded",()=>{chrome.storage.local.get(["darkMode"]).then(t=>{applyTheme(t.darkMode??!1)})}),document.getElementById("exportSettingsBtn").addEventListener("click",async()=>{try{const t=await chrome.storage.sync.get(SYNC_SETTINGS_KEYS),e=JSON.stringify(t,null,2),o=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(o),n=document.createElement("a");n.href=s,n.download="tab-suspender-settings.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s),showDataStatus("Settings exported!")}catch(t){console.error("Error exporting settings:",t),showDataStatus("Export failed",!0)}}),document.getElementById("importSettingsInput").addEventListener("change",t=>{const e=t.target.files[0];if(!e)return;const o=new FileReader;o.onload=async e=>{let o;try{o=JSON.parse(e.target.result)}catch(e){return console.error("Error parsing JSON:",e),showDataStatus("Import failed: Invalid JSON file",!0),void(t.target.value=null)}try{const t=await chrome.storage.sync.get(SYNC_SETTINGS_KEYS),e={},s=["isEnabled","ignoreAudio","ignoreFormInput","ignoreNotifications"];for(const t of s)o.hasOwnProperty(t)&&"boolean"==typeof o[t]&&(e[t]=o[t]);if(o.hasOwnProperty("suspendTime")){const t=parseInt(o.suspendTime,10);!isNaN(t)&&t>=1&&t<=1440&&(e.suspendTime=t)}const n=["whitelistedDomains","whitelistedUrls"];for(const s of n)if(o.hasOwnProperty(s)&&Array.isArray(o[s])){const n=new Set(t[s]||[]);for(const t of o[s])"string"==typeof t&&t.length>0&&n.add(t);e[s]=Array.from(n)}if(0===Object.keys(e).length)throw new Error("File contains no valid or recognized settings.");await chrome.storage.sync.set(e),showDataStatus("Settings imported successfully!")}catch(t){console.error("Error importing settings:",t),showDataStatus(`Import failed: ${t.message}`,!0)}finally{t.target.value=null}},o.onerror=()=>{console.error("File reading error"),showDataStatus("Import failed: Could not read file",!0)},o.readAsText(e)});